<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Hostel Management System{% endblock %}</title>
    
    <!-- Tailwind CSS + DaisyUI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.css" rel="stylesheet" type="text/css" />
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        sidebar: '#1F2937',
                    }
                }
            }
        }
    </script>
    
    <style>
        .sidebar-transition { transition: all 0.3s ease-in-out; }
        .content-scroll::-webkit-scrollbar { width: 6px; }
        .content-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .content-scroll::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 10px; }
        .content-scroll::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
        
        /* Mobile sidebar */
        @media (max-width: 768px) {
            .mobile-sidebar {
                transform: translateX(-100%);
            }
            .mobile-sidebar.active {
                transform: translateX(0);
            }
        }
        
        .sidebar-overlay {
            display: none;
        }
        
        .sidebar-overlay.active {
            display: block;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen">
    {% if user.is_authenticated %}
    <!-- Mobile Sidebar Overlay -->
    <div id="sidebarOverlay" class="sidebar-overlay fixed inset-0 bg-black bg-opacity-50 z-40" onclick="toggleSidebar()"></div>
    
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed md:relative w-64 bg-sidebar text-white flex flex-col flex-shrink-0 sidebar-transition mobile-sidebar z-50 shadow-xl h-full">
            <!-- Logo Section -->
            <div class="flex items-center gap-3 px-6 py-5 border-b border-gray-700">
                <div class="p-2 bg-primary rounded-lg">
                    <i data-lucide="building" class="w-6 h-6 text-white"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight">Hostel MS</h1>
                    <p class="text-xs text-gray-400">Management System</p>
                </div>
            </div>

            <!-- User Info -->
            <div class="px-6 py-4 border-b border-gray-700">
                <p class="text-sm text-gray-400 mb-1">Welcome back</p>
                <div class="flex items-center gap-3">
                    <div class="avatar">
                        <div class="w-10 h-10 rounded-full ring-2 ring-primary ring-offset-2 ring-offset-sidebar overflow-hidden">
                            <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=6366F1&color=fff&bold=true" 
                                 alt="{{ user.username }}" />
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="font-semibold text-sm truncate">{{ user.get_full_name|default:user.username }}</p>
                        <span class="badge badge-xs badge-primary mt-1">{{ user.get_role_display }}</span>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-2 overflow-y-auto">
                <a href="{% url 'dashboard' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl transition {% if request.resolver_match.url_name == 'dashboard' %}bg-primary text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}">
                    <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                    <span class="font-medium">Dashboard</span>
                </a>
                
                <a href="{% url 'room_list' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl transition {% if 'room' in request.resolver_match.url_name %}bg-primary text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}">
                    <i data-lucide="door-closed" class="w-5 h-5"></i>
                    <span class="font-medium">Rooms</span>
                </a>
                
                {% if user.role in 'admin manager' %}
                <a href="{% url 'occupancy_list' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl transition {% if 'occupancy' in request.resolver_match.url_name %}bg-primary text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}">
                    <i data-lucide="users" class="w-5 h-5"></i>
                    <span class="font-medium">Occupancies</span>
                </a>
                {% endif %}
                
                <a href="{% url 'payment_list' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl transition {% if 'payment' in request.resolver_match.url_name %}bg-primary text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}">
                    <i data-lucide="credit-card" class="w-5 h-5"></i>
                    <span class="font-medium">Payments</span>
                </a>
                
                <a href="{% url 'issue_list' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl transition {% if 'issue' in request.resolver_match.url_name %}bg-primary text-white shadow-lg{% else %}text-gray-300 hover:bg-gray-700 hover:text-white{% endif %}">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                    <span class="font-medium">Issues</span>
                </a>
            </nav>

            <!-- Footer -->
            <div class="px-6 py-4 border-t border-gray-700">
                <a href="{% url 'logout' %}" class="flex items-center gap-3 px-3 py-3 rounded-xl text-gray-300 hover:bg-red-600 hover:text-white transition">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    <span class="font-medium">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col overflow-hidden">
            <!-- Header -->
            <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-40">
                <div class="flex justify-between items-center px-4 md:px-6 py-4">
                    <div class="flex items-center gap-4">
                        <!-- Mobile Menu Toggle -->
                        <button onclick="toggleSidebar()" class="md:hidden btn btn-ghost btn-sm">
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>
                        <div>
                            <h2 class="text-xl md:text-2xl font-bold text-gray-800">{% block header %}Dashboard{% endblock %}</h2>
                            <p class="text-gray-500 text-xs md:text-sm mt-1 hidden sm:block">{% block subheader %}Hostel Management System{% endblock %}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <span class="text-gray-700 font-medium hidden md:block">{{ user.get_full_name|default:user.username }}</span>
                        <div class="avatar">
                            <div class="w-10 h-10 rounded-full ring-2 ring-primary ring-offset-2 overflow-hidden">
                                <img src="https://ui-avatars.com/api/?name={{ user.username }}&background=6366F1&color=fff&bold=true" 
                                     alt="{{ user.username }}" />
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Messages -->
            {% if messages %}
            <div class="px-6 pt-4">
                {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}error{% else %}{{ message.tags }}{% endif %} shadow-lg mb-4 transition">
                    <div class="flex items-center">
                        {% if message.tags == 'success' %}
                        <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i>
                        {% elif message.tags == 'error' %}
                        <i data-lucide="alert-circle" class="w-5 h-5 mr-2"></i>
                        {% elif message.tags == 'warning' %}
                        <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                        {% else %}
                        <i data-lucide="info" class="w-5 h-5 mr-2"></i>
                        {% endif %}
                        <span>{{ message }}</span>
                    </div>
                    <button onclick="this.parentElement.remove()" class="btn btn-ghost btn-xs">
                        <i data-lucide="x" class="w-4 h-4"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Page Content -->
            <div class="flex-1 p-6 overflow-y-auto content-scroll bg-gray-50">
                {% block content %}{% endblock %}
            </div>
        </main>
    </div>
    {% else %}
        {% block full_content %}{% endblock %}
    {% endif %}

    <script>
        lucide.createIcons();
        
        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // Close sidebar when clicking on a link (mobile only)
        if (window.innerWidth < 768) {
            document.querySelectorAll('#sidebar a').forEach(link => {
                link.addEventListener('click', () => {
                    toggleSidebar();
                });
            });
        }
    </script>
    {% block extra_js %}{% endblock %}
</body>
</html>